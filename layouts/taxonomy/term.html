{{ define "main" }}

{{/* Determine taxonomy type for color scheme */}}
{{ $taxonomyType := .Data.Plural }}

{{/* Load taxonomy data from JSON registry */}}
{{ $taxonomyData := index site.Data.taxonomies $taxonomyType }}
{{ $currentTerm := .Title | urlize }}
{{ $termData := "" }}
{{ range $taxonomyData }}
  {{ if eq .id $currentTerm }}
    {{ $termData = . }}
  {{ end }}
{{ end }}

{{/* Get current language */}}
{{ $lang := .Language.Lang }}

{{/* Get localized description */}}
{{ $description := "" }}
{{ if $termData }}
  {{ if $termData.short_description }}
    {{ $description = index $termData.short_description $lang }}
  {{ end }}
{{ end }}
{{ if not $description }}
  {{ $description = .Description }}
{{ end }}

{{/* Use unified teal gradient for all taxonomy term pages */}}
{{ $gradientClass := "split-hero--teal" }}

{{/* Try to load hero image */}}
{{ $heroImage := "" }}
{{ $heroPath := printf "images/dimensions/%s/%s/originals/" $taxonomyType $currentTerm }}
{{ $heroResources := resources.Match (printf "%s*.jpg" $heroPath) }}
{{ if $heroResources }}
  {{ $heroImage = index $heroResources 0 }}
{{ end }}

<!-- Split-Panel Hero -->
<section class="panel panel--hero-split">
  <div class="split-hero {{ $gradientClass }}">
    <div class="split-hero__content">
      <div class="taxonomy-meta">
        <span class="taxonomy-type">{{ .Data.Plural | humanize | title }}</span>
      </div>
      <h1 class="split-hero__title">{{ .Title }}</h1>
      {{ with $description }}
        <p class="split-hero__subtitle">{{ . }}</p>
      {{ end }}
      <div class="taxonomy-term-count">
        {{ .Pages | len }} {{ if eq (.Pages | len) 1 }}{{ i18n "brand" | default "brand" }}{{ else }}{{ i18n "brands" | default "brands" }}{{ end }}
      </div>
    </div>
    {{ if $heroImage }}
    <div class="split-hero__image">
      {{ $resized := $heroImage.Resize "1200x800 q85" }}
      <img src="{{ $resized.RelPermalink }}" alt="{{ .Title }}" loading="eager">
    </div>
    {{ end }}
  </div>
</section>

<!-- Optional Rich Content -->
{{ with .Content }}
  <section class="panel panel--light">
    <div class="panel__content taxonomy-content">
      {{ . }}
    </div>
  </section>
{{ end }}

<!-- Brand Grid Panel -->
<section class="panel panel--neutral-soft">
  <div class="panel__content">
    {{ if .Pages }}
      <div class="brand-grid">
        {{ range .Pages }}
          {{ partial "card-brand.html" . }}
        {{ end }}
      </div>
    {{ else }}
      <p class="no-content">{{ i18n "taxonomy_no_brands" | default "No brands found in this category yet" }}.</p>
    {{ end }}
  </div>
</section>

{{ end }}
