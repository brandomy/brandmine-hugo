{{- $index := slice -}}

{{- range .Site.Pages -}}
  {{- if and (eq .Section "brands") (eq .Language.Lang "en") .File -}}
    {{- $city := "" -}}
    {{- $region := "" -}}
    {{- with .Params.headquarters -}}
      {{- $city = .city | default "" -}}
      {{- $region = .region | default "" -}}
    {{- end -}}

    {{- $entry := dict
      "id" .File.UniqueID
      "title" .Title
      "description" (.Params.description | default (.Summary | plainify | truncate 150))
      "url" .Permalink
      "type" "brand"
      "lang" .Language.Lang
      "founded" (.Params.founded | default 0)
      "city" $city
      "region" $region
      "markets" (.Params.markets | default slice)
      "sectors" (.Params.sectors | default slice)
      "attributes" (.Params.attributes | default slice)
      "signals" (.Params.signals | default slice)
      "founder" (.Params.founder | default "")
    -}}
    {{- $index = $index | append $entry -}}
  {{- end -}}
{{- end -}}

{{- $index | jsonify -}}
