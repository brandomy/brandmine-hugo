<!-- Contact Form with Supabase Integration -->
<form id="contact-form" class="contact-form">

  <!-- Name Field -->
  <div class="form-group">
    <label for="name">
      {{ i18n "form_name" }} <span class="required">*</span>
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
    >
  </div>

  <!-- Email Field -->
  <div class="form-group">
    <label for="email">
      {{ i18n "form_email" }} <span class="required">*</span>
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
    >
  </div>

  <!-- Contact Type Field -->
  <div class="form-group">
    <label for="contact_type">
      {{ i18n "form_i_am_a" }} <span class="required">*</span>
    </label>
    <select
      id="contact_type"
      name="contact_type"
      required
    >
      <option value="">{{ i18n "form_select" }}</option>
      <option value="brand">{{ i18n "form_brand" }}</option>
      <option value="partner">{{ i18n "form_partner_investor" }}</option>
      <option value="job_seeker">{{ i18n "form_job_seeker" }}</option>
      <option value="other">{{ i18n "form_other" }}</option>
    </select>
  </div>

  <!-- Company Field (Optional) -->
  <div class="form-group">
    <label for="company">
      {{ i18n "form_company" }} <span class="optional">({{ i18n "form_optional" }})</span>
    </label>
    <input
      type="text"
      id="company"
      name="company"
    >
  </div>

  <!-- Message Field -->
  <div class="form-group">
    <label for="message">
      {{ i18n "form_message" }} <span class="required">*</span>
    </label>
    <textarea
      id="message"
      name="message"
      rows="5"
      required
    ></textarea>
  </div>

  <!-- Referral Source Field -->
  <div class="form-group">
    <label for="referral_source">
      {{ i18n "form_how_heard" }}
    </label>
    <select
      id="referral_source"
      name="referral_source"
    >
      <option value="">{{ i18n "form_select" }}</option>
      <option value="search">{{ i18n "form_search" }}</option>
      <option value="linkedin">{{ i18n "form_linkedin" }}</option>
      <option value="referral">{{ i18n "form_referral" }}</option>
      <option value="other">{{ i18n "form_other" }}</option>
    </select>
  </div>

  <!-- Country Field -->
  <div class="form-group">
    <label for="country">
      {{ i18n "form_country" }}
    </label>
    <select
      id="country"
      name="country"
    >
      <option value="">{{ i18n "form_select" }}</option>
      <!-- BRICS+ Countries -->
      <option value="brazil">🇧🇷 {{ i18n "country_brazil" }}</option>
      <option value="russia">🇷🇺 {{ i18n "country_russia" }}</option>
      <option value="india">🇮🇳 {{ i18n "country_india" }}</option>
      <option value="china">🇨🇳 {{ i18n "country_china" }}</option>
      <option value="south_africa">🇿🇦 {{ i18n "country_south_africa" }}</option>
      <option value="egypt">🇪🇬 {{ i18n "country_egypt" }}</option>
      <option value="ethiopia">🇪🇹 {{ i18n "country_ethiopia" }}</option>
      <option value="iran">🇮🇷 {{ i18n "country_iran" }}</option>
      <option value="uae">🇦🇪 {{ i18n "country_uae" }}</option>
      <option value="indonesia">🇮🇩 {{ i18n "country_indonesia" }}</option>
      <option value="malaysia">🇲🇾 {{ i18n "country_malaysia" }}</option>
      <option value="philippines">🇵🇭 {{ i18n "country_philippines" }}</option>
      <option value="singapore">🇸🇬 {{ i18n "country_singapore" }}</option>
      <option value="thailand">🇹🇭 {{ i18n "country_thailand" }}</option>
      <option value="vietnam">🇻🇳 {{ i18n "country_vietnam" }}</option>
      <option value="other">🌍 {{ i18n "country_other" }}</option>
    </select>
  </div>

  <!-- Source Tracking (hidden) -->
  <input type="hidden" name="source" value="{{ if .source }}{{ .source }}{{ else }}about{{ end }}">

  <!-- Success/Error Messages -->
  <div id="form-message"></div>

  <!-- Submit Button -->
  <button type="submit" class="btn btn--secondary">
    {{ i18n "form_submit" }}
  </button>
</form>

<!-- Supabase Form Handler Script -->
<script>
  document.getElementById('contact-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitButton = e.target.querySelector('button[type="submit"]');
    const messageDiv = document.getElementById('form-message');
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);

    // Add timestamp
    data.created_at = new Date().toISOString();

    // Disable button and show loading state
    submitButton.disabled = true;
    submitButton.textContent = '{{ i18n "form_sending" | default "Sending..." }}';

    try {
      // Supabase credentials from environment variables (.env.local)
      const SUPABASE_URL = '{{ getenv "SUPABASE_URL" }}';
      const SUPABASE_ANON_KEY = '{{ getenv "SUPABASE_ANON_KEY" }}';

      const response = await fetch(`${SUPABASE_URL}/rest/v1/contacts`, {
        method: 'POST',
        headers: {
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          'Prefer': 'return=minimal'
        },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        // Success
        messageDiv.style.display = 'block';
        messageDiv.style.background = 'rgba(16, 185, 129, 0.2)';
        messageDiv.style.border = '1px solid rgba(16, 185, 129, 0.5)';
        messageDiv.style.color = 'white';
        messageDiv.textContent = '{{ i18n "form_success" | default "Thank you! We'll be in touch soon." }}';

        // Reset form
        e.target.reset();

        // Re-enable button
        submitButton.disabled = false;
        submitButton.textContent = '{{ i18n "form_submit" }}';
      } else {
        throw new Error('Submission failed');
      }
    } catch (error) {
      // Error
      messageDiv.style.display = 'block';
      messageDiv.style.background = 'rgba(239, 68, 68, 0.2)';
      messageDiv.style.border = '1px solid rgba(239, 68, 68, 0.5)';
      messageDiv.style.color = 'white';
      messageDiv.textContent = '{{ i18n "form_error" | default "Something went wrong. Please try again." }}';

      // Re-enable button
      submitButton.disabled = false;
      submitButton.textContent = '{{ i18n "form_submit" }}';

      console.error('Form submission error:', error);
    }
  });
</script>
