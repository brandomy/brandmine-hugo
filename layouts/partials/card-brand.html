{{/*
  Brand Card Component

  Usage:
    {{ partial "card-brand.html" . }}

  Context: Brand page object

  Features:
  - Hero image (16:9 aspect ratio)
  - Metric badge overlay (revenue)
  - Title + tagline
  - Taxonomy tags (markets + sectors on row 1, attributes on row 2)
  - Teal CTA button
*/}}

{{ $brandSlug := path.Base .File.Dir }}
{{ $heroImage := .Params.heroImage | default "placeholder-brand.jpg" }}
{{ $imagePath := printf "images/brands/%s/originals/%s" $brandSlug $heroImage }}
{{ $image := resources.Get $imagePath }}
{{ $labels := dict }}
{{ with .Site.Data }}
  {{ with index . "taxonomy-labels" }}
    {{ with index . $.Site.Language.Lang }}
      {{ $labels = . }}
    {{ end }}
  {{ end }}
{{ end }}

<article class="card card--brand">
  {{/* Hero Image */}}
  <div class="card__image">
    {{ if $image }}
      {{ $resized := $image.Resize "800x450 q85" }}
      <img
        src="{{ $resized.RelPermalink }}"
        alt="{{ .Title }}"
        loading="lazy"
      >
    {{ else }}
      <img
        src="/images/placeholder-brand.jpg"
        alt="{{ .Title }}"
        loading="lazy"
      >
    {{ end }}

    {{/* Metric Badge Overlay */}}
    {{ $metric := .Params.turnover | default .Params.revenue }}
    {{ with $metric }}
      <div class="card__metric">
        <div class="metric__value">{{ . }}</div>
        <div class="metric__label">{{ if $.Params.turnover }}Turnover{{ else }}Revenue{{ end }}</div>
      </div>
    {{ end }}
  </div>

  {{/* Card Content */}}
  <div class="card__content">
    {{/* Title */}}
    <h3 class="card__title">
      <a href="{{ .RelPermalink }}">{{ .Title }}</a>
    </h3>

    {{/* Tagline */}}
    {{ with .Params.description }}
      <p class="card__tagline">{{ . }}</p>
    {{ end }}

    {{/* Location */}}
    {{ with .Params.headquarters }}
      <p class="card__location">
        {{ .city }}{{ if .country }}{{ $countryData := index $.Site.Data.countries.countries .country }}{{ if $countryData }} {{ $countryData.emoji }}{{ end }}{{ end }}
      </p>
    {{ end }}

    {{/* Taxonomy Tags - Only the 4 dimensions */}}
    <div class="card__tags">
      {{ range .Params.markets }}
        <a href="{{ "/markets/" | relLangURL }}{{ . | urlize }}" class="tag tag--market">
          {{ index $labels.markets . | default (. | humanize | title) }}
        </a>
      {{ end }}
      {{ range .Params.sectors }}
        <a href="{{ "/sectors/" | relLangURL }}{{ . | urlize }}" class="tag tag--sector">
          {{ index $labels.sectors . | default (. | humanize | title) }}
        </a>
      {{ end }}
      {{ range .Params.attributes }}
        <a href="{{ "/attributes/" | relLangURL }}{{ . | urlize }}" class="tag tag--attribute">
          {{ index $labels.attributes . | default (. | humanize | title) }}
        </a>
      {{ end }}
      {{ range .Params.signals }}
        <a href="{{ "/signals/" | relLangURL }}{{ . | urlize }}" class="tag tag--signal">
          {{ index $labels.signals . | default (. | humanize | title) }}
        </a>
      {{ end }}
    </div>
  </div>

  {{/* Card Footer - CTA */}}
  <div class="card__footer">
    <a href="{{ .RelPermalink }}" class="card__cta">
      {{ i18n "view_profile" | default "View Profile" }}
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
  </div>

  {{/* Hidden search terms for multilingual search indexing */}}
  <div class="card__search-data" style="position: absolute; left: -9999px;" aria-hidden="true">
    {{ range .Params.markets }}{{ . }} {{ index $labels.markets . }} {{ end }}
    {{ range .Params.sectors }}{{ . }} {{ index $labels.sectors . }} {{ end }}
    {{ range .Params.attributes }}{{ . }} {{ index $labels.attributes . }} {{ end }}
    {{ range .Params.signals }}{{ . }} {{ index $labels.signals . }} {{ end }}
  </div>
</article>
