{{/*
  Founder Card Component

  Usage:
    {{ partial "card-founder.html" . }}

  Context: Founder page object

  Features:
  - Portrait photo (4:5 aspect ratio)
  - Name
  - Founded date + location with flag emoji
  - One-line bio
  - Associated brands (linked)
  - Taxonomy tags
  - Teal CTA button
*/}}

{{ $founderSlug := path.Base .File.Dir }}
{{ $photo := .Params.image | default "placeholder-founder.jpg" }}
{{ $imagePath := printf "images/founders/%s/originals/%s" $founderSlug $photo }}
{{ $image := resources.Get $imagePath }}
{{ if not $image }}
  {{/* Fallback: Try without originals/ subdirectory */}}
  {{ $imagePath = printf "images/founders/%s/%s" $founderSlug $photo }}
  {{ $image = resources.Get $imagePath }}
{{ end }}
{{ if not $image }}
  {{/* Final fallback: placeholder */}}
  {{ $image = resources.Get "images/placeholders/originals/founder-headshot.jpg" }}
{{ end }}

<article class="card card--founder" data-founder-id="{{ .RelPermalink }}" data-searchable="{{ .Params.name | lower }} {{ with .Params.role }}{{ . | lower }}{{ end }} {{ with .Params.bio }}{{ . | lower }}{{ end }} {{ with .Params.city }}{{ . | lower }}{{ end }}">
  {{/* Portrait Photo with Experience Metric - Clickable */}}
  <a href="{{ .RelPermalink }}" class="card__image-link">
    <div class="card__image">
      {{ if $image }}
        <img
          src="{{ $image.RelPermalink }}"
          alt="{{ .Title }}"
          loading="lazy"
        >
        {{/* Generation Badge */}}
        {{ if .Params.generation }}
          {{ $genValue := "" }}
          {{ if eq .Params.generation "first" }}{{ $genValue = "1st" }}{{ end }}
          {{ if eq .Params.generation "second" }}{{ $genValue = "2nd" }}{{ end }}
          {{ if eq .Params.generation "third" }}{{ $genValue = "3rd" }}{{ end }}
          {{ if eq .Params.generation "fourth" }}{{ $genValue = "4th" }}{{ end }}
          {{ if $genValue }}
            <div class="card__metric card__metric--generation">
              <span class="metric__value">{{ $genValue }}</span>
              <span class="metric__label">GEN</span>
            </div>
          {{ end }}
        {{ else if .Params.yearsExperience }}
          <div class="card__metric">
            <span class="metric__value">{{ .Params.yearsExperience }}+</span>
            <span class="metric__label">YEARS</span>
          </div>
        {{ else if .Params.founded }}
          <div class="card__metric">
            <span class="metric__value">{{ .Params.founded }}</span>
            <span class="metric__label">FOUNDED</span>
          </div>
        {{ end }}
      {{ else }}
        <div class="card__image-placeholder">
          <span>{{ .Title | truncate 2 "" }}</span>
        </div>
      {{ end }}
    </div>
  </a>

  {{/* Card Content */}}
  <div class="card__content">
    {{/* Name */}}
    <h3 class="card__title">
      <a href="{{ .RelPermalink }}">{{ .Params.name }}</a>
    </h3>

    {{/* Role */}}
    {{ with .Params.role }}
      <p class="card__role">{{ . }}</p>
    {{ end }}

    {{/* Company & Location - One Line */}}
    <div class="card__meta">
      {{ with .Params.brands }}
        {{ $brands := . }}
        {{ range $index, $brandSlug := $brands }}
          {{ $brandPage := site.GetPage (printf "/brands/%s" $brandSlug) }}
          {{ if $brandPage }}
            <a href="{{ $brandPage.RelPermalink }}" class="card__company-link">{{ $brandPage.Title }}</a>
          {{ else }}
            <span class="card__company-name">{{ $brandSlug | humanize }}</span>
          {{ end }}
        {{ end }}
      {{ end }}
      {{ if and .Params.brands (or .Params.city .Params.country) }}
        <span class="card__separator card__separator--bullet">‚ú¶</span>
      {{ end }}
      {{ if or .Params.city .Params.country }}
        <span class="card__location">
          {{ with .Params.city }}{{ . }}{{ end }}
          {{ if .Params.country }}
            {{ $countryCode := .Params.country }}
            {{ $countryData := index .Site.Data.countries.countries $countryCode }}
            {{ if $countryData }}
              {{ with $countryData.emoji }} {{ . }}{{ end }}
            {{ end }}
          {{ end }}
        </span>
      {{ end }}
    </div>

    {{/* Key Achievement Callout */}}
    {{ with .Params.keyAchievement }}
      <div class="card__achievement">
        <div class="achievement__label">üèÜ KEY ACHIEVEMENT</div>
        <div class="achievement__text">{{ . }}</div>
      </div>
    {{ end }}

    {{/* Bio */}}
    {{ with .Params.bio }}
      <p class="card__bio">{{ . }}</p>
    {{ end }}

    {{/* Expertise Tags */}}
    {{ with .Params.expertise }}
      <div class="card__tags">
        {{ range . }}
          <span class="tag tag--expertise">{{ . }}</span>
        {{ end }}
      </div>
    {{ end }}
  </div>

  {{/* Card Footer - CTA */}}
  <div class="card__footer">
    <a href="{{ .RelPermalink }}" class="card__cta">
      {{ i18n "view_profile" | default "View Profile" }}
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
  </div>
</article>
